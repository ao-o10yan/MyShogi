
# 『将棋神やねうら王』(2018年8月31日発売) Work In Progress

- このファイルは、既知の問題や作業中の内容を明示することにより、それらに対するバグ報告を防ぐためのものです。


# 修正の予定のない内容

- 18コアのPCでも2スレッドしか使われていない。
  - 「将棋神」「カスタム」以外を選択した時は、その棋力を担保するために、Threads = 2 , NodesLimit = XXXが設定されるためです。
- 棋譜の読み上げについて音量がバラバラ…。
  - 私も気になってはいますが、激指の素材そのままです。今回はどうしようもなさげです。
  - 次回(来年？)は音声の収録から私が立ち会います(｀･ω･´)ｂ
- サウンドが鳴らない件
  - Windows Media Playerが使える環境でないと再生されないようです。
  - 詳しくは、[FAQ](faq.md)をご覧ください。


# マスターアップ後のアップデートで対応するかもです。

- ウィンドウを最大化したならそれを終了時に保存/次回起動時に復元すべき。(tanuki-さん)

- 連続対局
	- 実装作業あとでやる

- ponder(「相手の手番で先読み」)が機能していない
  - 未実装。
  - マスターアップに間に合わなさそうなら、この表示(「相手の手番で先読み」)、オフにする。
  - この実装、わりとややこしくて、激指ユーザーとかがターゲットなので必須機能とも言えないので。
- 手番表示、名前に被る件。(tibigameさん)
  - ネームプレートと棋譜ウィンドウ少し下げて、ネームプレートの左上に持ってくる。
- 検討ウィンドウのカラムの横幅を次回起動時に復元して欲しい。(masaさん)
- 対局開始時、「エンジン初期化」が表示されるタイミングが遅い。(ぐららるさん)

- 詰将棋エンジンでの検討
  - 詰み手順、攻め方最短・受け方最長の手順が返ってこない。tanuki-詰将棋エンジンの仕様っぽい。
  - tanuki-さんに修正を依頼。
  - 詰検討おまけ機能なので、最悪、このままマスターアップでも仕方ないか…。

- 棋譜
  - 棋譜の自動保存
  - 本譜のみ書き出し
  - 棋譜のマージ
  - 棋譜コメントの表示、編集等
  - 思考エンジンの読み筋を棋譜コメントに記録する

- 棋譜解析

- 形勢グラフ(マスターアップに間に合わなさそうなのでいったん無効化)
  - Mizarさんに作ってもらったのですが、私(やねうらお)がある程度作業しないといけなくて、その作業が間に合いそうにないため。
	- このウィンドウ邪魔なので、検討ウィンドウに埋める予定
  	- マスターアップまでに作業が間に合わないかも。その場合は形勢グラフをなくす。
  - ToolStripの◀▶で局面を移動させた時にその局面での形勢表示にならない。
    - 検討ウィンドウのほうと合わせ、通知のハンドラちゃんと書く。
  - 着手や終局の直後に入れ違いで前の局面の思考が送られてきた時に、次の局面の評価値として記録してしまう。
    - 終局まぎわ、即座に指し手が送られてくるのでこの現象が起きやすい。
    - あとで修正する。
  - このソフトで保存した棋譜を再度読み込んだ時にその評価値が形勢グラフに反映されない。
  - 駒落ちの時、詰まされると落ちる。(tkponさん)
    - 形勢グラフの範囲外にプロットしている模様。

# 作業中の内容

- マスターアップ完了で一段落したため、現在、作業中の内容はありません。
- アップデートに向けて、上記の内容を一つずつ作業していきます。

# 改修履歴


- β10を『将棋神やねうら王』(2018年8月31日発売)のマスターアップ版としました。ご協力いただいた皆様、ありがとうございました。


- β9からβ10で改修した点[2018/08/05]
  - 局面を読み込ませての検討モードの時に11の駒を取る移動が同Xと検討の読み筋に表示される。(ぐららるさん)
    - 修正しました。
  - 読み筋に出現する「resign」は「投了」と表示するように。
  - 「検討時の駒音」変更したときにメニュー更新されない。(ぐららるさん)
    - PieceSoundOffTheGameの変更に対してUpdateMenuItem()のハンドラセットしてなかった。


- β8からβ9で改修した点[2018/08/05]
  - エンジン同士の対局で「中」を押した時にファイルメニューがアクティブにならないことがある。(masaさん , まふさん)
     - たぶん修正できた。
  - 検討モード、詰検討モードから「検」「詰」ボタンを押しても反応しないことがあったの修正。
  - 棋譜を開いて終局図を出したときに駒が浮いた状態になることがある。(uuunuuunさん)
    - 駒選択状態から、棋譜読み込み・棋譜貼り付けなどを行うとこの状態になる。修正しました。
  - 詰検討で秒数指定をして検討を開始すると例外が出る。
    - 詰将棋エンジン側が対応してない。 
    - とりま、詰検討設定の時間設定をするGroupBox無効化しておく。発売後のアップデートで対応するかも。
  - COM同士の対局のあと検討を開くとnull参照で落ちる件。(うさ親さん)
  - 読み筋にある win(宣言勝ち) が表示されない。
    - 読み筋に宣言勝ち、千日手、千日手勝ち、千日手負け、優等局面、劣等局面を表示するようにした。
    - 宣言勝ちと千日手引分が表示されることは確認した。他は局面がなくてわからない。
  - RDPで棋譜の再生時に表示が乱れる件。(suimonさん)
  - 手数が長くなってくると棋譜ウィンドウでの移動時に画面がちらつく件。(うさ親さん)
  - 詰将棋エンジンの個別設定が反映していなかった件、修正。
  - 詰将棋用エンジンのオプション画面、それ用にカスタマイズした。
  -  エンジン選択ダイアログを閉じたときに画面ちらついてたの、ちらつかなくなった。
  - 「エンジン選択ダイアログ」が2つ出た状態になる件。(masaさん)
    - 修正しました。
  - 対局終了後に読み上げがずっと続くの止められない件。(masaさん)
    - 対局終了でそこで以降の読み上げをキャンセルして「ありがとうございました」の音声を出すことにした。
    - メニュー → 音声のところで選択できるようにしました。
  - 宣言勝ちが非合法手に扱われてしまうことがある件。(masaさん)
    - 対局設定ダイアログの入玉設定の項目の並び順がエンジンオプション設定の同設定の項目の並び順とが異なっていたのが原因。修正しました。
  - ダイアログのセンタリングで画面外に出ることがある件。(tanuki-さん)
    - 新しく作られるダイアログが画面外に出ないように修正しました。
    - 上下・左右のどちらかにめり込まないと表示できない時は、右と下にめり込むのは許容。左と上にめり込むのは認めない。(ウィンドウのドラッグ、閉じるが出来なくなるため)

  ## 過去の改修履歴

  - ここ以前の改修履歴については、[過去の改修履歴](過去の改修履歴.md)のほうに移動させました。
