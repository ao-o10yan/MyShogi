
# 『将棋神やねうら王』(2018年8月31日発売) アップデートなどの作業進捗 (Work In Progress)


- このファイルは、既知の問題や作業中の内容を明示することにより、それらに対するバグ報告を未然に防ぐためのものです。

- 全般的な操作説明については[オンラインマニュアル](online_manual.md)をご覧ください。
- アップデート関連の情報、サウンドが再生されない、CPU負荷が高すぎる/低すぎるなどについては、[よくある質問](faq.md)をご覧ください。
- デバッグ機能の使い方などは、[開発者向け機能](dev_manual.md)をご覧ください。
- バグ、要望等は、こちらの記事にどうぞ。→ [『将棋神やねうら王』Update3までの遊戯施設 / やねうら王ブログ](http://yaneuraou.yaneu.com/2018/10/06/%E3%80%8E%E5%B0%86%E6%A3%8B%E7%A5%9E%E3%82%84%E3%81%AD%E3%81%86%E3%82%89%E7%8E%8B%E3%80%8Fupdate3%E3%81%BE%E3%81%A7%E3%81%AE%E9%81%8A%E6%88%AF%E6%96%BD%E8%A8%AD/)


# Update3(2018年10月下旬ごろリリース予定)に向けて作業中です(ここに書かれているすべての機能追加をお約束するものではありません)

// 作業中

- Mac(Mono環境)でMessageBox.Show()が使えない件
  - 自前で描画する
  - アイコン素材発注済み    

- 全体設定
  - もっと使いやすい、わかりやすい表示設定・音声設定ダイアログを用意する
  - 各ダイアログのフォント変更機能(フォントサイズも)

// このあとやる予定

- 対局設定
  - 時間計測「秒未満切り捨て、最低1秒」「秒未満切り捨て、最低0秒」「秒未満も記録」
  - ストップウォッチ方式の計測も出来るように。(これはUpdate4以降かも)
  - SkillLevel + 秒固定の棋力プリセットがあってもいいのでは。(odagakiさん)


- 駒得のみの評価関数「駒得大好きくん 2018」の思考エンジン追加。

- 対局
  - 駒をクリックしたときにマウスカーソルに駒が追随する設定の追加。(宏さん)
  
- 検討ウインドウ
  - 詰手順の出力機能
  - ミニ盤面のフロート

- 棋譜ウインドウ
  - 棋譜ウインドウのメッセージング処理変更
  - メインウインドウに埋め込み時に畳の左端に表示するモードを追加(kumaさん)
  - 総消費時間の表示
  - 棋譜コメントの表示、編集等
  - 思考エンジンの読み筋を棋譜コメントに記録する

- 成り/不成の選択、後手側だと180度回転させてあって欲しい。(ぐららるさん)

- 形勢グラフ(作業中)
	- このウィンドウ邪魔なので、フロート機能・検討ウインドウに埋める機能などを持たせる予定。
  - ToolStripの◀▶で局面を移動させた時にその局面での形勢表示にならない。
    - 検討ウィンドウのほうと合わせ、通知のハンドラちゃんと書く。
  - 着手や終局の直後に入れ違いで前の局面の思考が送られてきた時に、次の局面の評価値として記録してしまう。
    - あとで修正する。
  - このソフトで保存した棋譜を再度読み込んだ時にその評価値が形勢グラフに反映されない。
  - 駒落ちの時、詰まされると落ちる。(tkponさん)
    - 形勢グラフの範囲外にプロットしている模様。

- ファイルヒストリー(MRUF)
  - ファイルヒストリー、閉じる前に開いていた局面を開いて欲しい。(まふさん)


# Update4以降で対応を検討中


- 棋譜解析
  - 期待勝率に基づく悪手判定
  - MultiPV / 詰め探索などを併用した悪手度の判定
  - 棋力を設定して、その棋力にそぐわない指し手の検出機能

- 描画の高速化
	- 画面描画の時の更新矩形を最適化する
		- 残り時間の描画など

- USIプロトコル対応エンジンを任意に追加する機能
  - エンジンの個別設定をコピーする機能(同エンジン対局がしやすくなる) (odagakiさん)

- ponder(「相手の手番で先読み」)
  - この実装、わりとややこしくて、激指ユーザーとかがターゲットなので必須機能とも言えないので後回し。

- 対局
  - 対局中断→再開が欲しい。
  - 棋譜の途中から対局をするとき、そこより手数を戻そうとすると持ち時間がゼロになるので時間切れ負けになる件
  - 対局終了時に、消していた開始局面以降の分岐を復元する。激指はそうなっている。(T.Kさん)

- 棋譜ウインドウ
  - 棋譜分岐、分岐の指し手、一覧が表示されて欲しい気が。
    - もう少しいいインターフェースを考え中。
  - 棋譜のマージ
  - 棋譜の記法で駒打ちのときには必ず「打」を記すオプション
    - 棋譜表記は、以下のサイトを参考に忠実に守っているのだが、「打」の文字が無いのはわかりにくいと不評。
    - 日本将棋連盟 「棋譜の表記方法」: https://www.shogi.or.jp/faq/kihuhyouki.html
  - 棋譜の自動再生機能

- Mac/Linuxで簡単にビルド出来るように。


# 改修履歴


- "1.2.4"→"1.2.5" [2018/10/06]-[2018/10/XX]
  - FontUtilityにParentのnullチェック追加。(海苔さんからの指摘)
  - メニュー→ファイル「設定の初期化」を「設定」のところに移動。
  - メニュー→「設定」→「音声設定」追加。メニューから「音声」削除。
    - 「音声設定」にサウンド・音声全体のオン/オフ追加。
    - 「音声設定」に対局開始/終了時の挨拶の読み上げのオン/オフ追加。


## 過去の改修履歴

- ここ以前の改修履歴については、[過去の改修履歴](過去の改修履歴.md)のほうに移動させました。
