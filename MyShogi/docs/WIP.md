
# 『将棋神やねうら王』(2018年8月31日発売) アップデートなどの作業進捗 (Work In Progress)


- このファイルは、既知の問題や作業中の内容を明示することにより、それらに対するバグ報告を未然に防ぐためのものです。

- マイナビ公式のアップデート情報については、[マイナビ 将棋神やねうら王](https://book.mynavi.jp/ec/products/detail/id=92007)をご確認ください。
  - マイナビ公式のサイトにて、Update1.3(V1.13)が公開されました。[2018/09/06]
  - アップデート手順について、わかりやすい記事を用意しました。Update1.3や、開発中のバージョンにアップデートする方法が詳しく書いてあります。
    - [『将棋神やねうら王』のアップデート手順をわかりやすく](http://yaneuraou.yaneu.com/2018/09/09/%E3%80%8E%E5%B0%86%E6%A3%8B%E7%A5%9E%E3%82%84%E3%81%AD%E3%81%86%E3%82%89%E7%8E%8B%E3%80%8F%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%83%87%E3%83%BC%E3%83%88%E6%89%8B%E9%A0%86%E3%82%92%E3%82%8F%E3%81%8B/)
  - Update2(大型アップデートその2)は、2018年9月中旬を予定しています。棋譜解析・棋譜コメント機能・形勢グラフの追加などを予定しています。
- 全体的な操作説明については[オンラインマニュアル](online_manual.md)をご覧ください。
- サウンドが再生されない、CPU負荷が高すぎる/低すぎるなどについては、[よくある質問](faq.md)をご覧ください。
- デバッグ機能の使い方などは、[開発者向け機能](dev_manual.md)をご覧ください。
- バグ、要望等は、
  - [『将棋神やねうら王』Update2までの遊戯施設 / やねうら王ブログ](http://yaneuraou.yaneu.com/2018/09/06/%E3%80%8E%E5%B0%86%E6%A3%8B%E7%A5%9E%E3%82%84%E3%81%AD%E3%81%86%E3%82%89%E7%8E%8B%E3%80%8Fupdate2%E3%81%BE%E3%81%A7%E3%81%AE%E9%81%8A%E6%88%AF%E6%96%BD%E8%A8%AD/)
  にどうぞ。


# Update2(2018年9月中旬ごろリリース予定)に向けて作業中です(ここに書かれているすべての機能追加をお約束するものではありません)


- 対局画面
  - 画面エフェクトの有無の設定
  - ShogiGUIにあるような振り駒機能が欲しい。(math26さん)
    - 素材到着[2018/09/10]
  - 対局中断のときは「対局中断」の画像が表示されるように。
    - 素材到着[2018/09/10]

- 棋譜ウインドウ
  - 総消費時間の表示
  - 棋譜コメントの表示、編集等
  - 思考エンジンの読み筋を棋譜コメントに記録する

- 検討ウインドウ
  - 詰手順の出力機能
  - 棋譜ウインドウと同じくフロート機能追加する
  - ミニ盤面も同様

- 形勢グラフ(作業中)
	- このウィンドウ邪魔なので、フロート機能・検討ウインドウに埋める機能などを持たせる予定。
  - ToolStripの◀▶で局面を移動させた時にその局面での形勢表示にならない。
    - 検討ウィンドウのほうと合わせ、通知のハンドラちゃんと書く。
  - 着手や終局の直後に入れ違いで前の局面の思考が送られてきた時に、次の局面の評価値として記録してしまう。
    - あとで修正する。
  - このソフトで保存した棋譜を再度読み込んだ時にその評価値が形勢グラフに反映されない。
  - 駒落ちの時、詰まされると落ちる。(tkponさん)
    - 形勢グラフの範囲外にプロットしている模様。

- tanuki-詰将棋エンジン
  - 他の不詰の局面を調べた直後に(エンジンをそのまま終了させずに)、詰むはずの局面を解かせたときに即座に不詰が返ってくる問題。
  - 「終」ボタンでいったんエンジンを終了させて再度解かせると正常に解ける模様。調査中。


# Update3以降で対応を検討中


- 棋譜解析

- 描画の高速化
	- 画面描画の時の更新矩形を最適化する
		- 残り時間の描画など

- もっと使いやすい表示設定ダイアログを用意する

- USIプロトコル対応エンジンを任意に追加する機能

- ponder(「相手の手番で先読み」)
  - この実装、わりとややこしくて、激指ユーザーとかがターゲットなので必須機能とも言えないので後回し。

- 対局
  - 対局中断→再開が欲しい。
  - 棋譜の途中から対局をするとき、そこより手数を戻そうとすると持ち時間がゼロになるので時間切れ負けになる件

- 棋譜ウインドウ
  - 棋譜分岐、分岐の指し手、一覧が表示されて欲しい気が。
    - もう少しいいインターフェースを考え中。
  - 本譜のみを書き出す機能
  - 棋譜のマージ


# 改修履歴


- "1.1.6"→"1.1.7" [2018/09/10]-[2018/09/XX]
  - KIF : Kifu for Windowsのしおりを使った棋譜を読み込むと例外で落ちるのを修正。
    - KIF/KI2: "&" で始まる行を無視するように #54(Mizarさんのプルリク)
  - tanuki-詰将棋エンジン , 詰探索中の出力を変更した (#91)   (tanuki-さんのやねうら王へのプルリク)
    - clang++によるコンパイル警告を抑制した
    - 詰探索中の進捗状況の出力を変更した
    - Hash使用率が1秒ごとぐらいに更新されるようになった。
  - コンピューター側、指し手が速すぎて追いかけられないので、1手に必ず1秒使うようなモードが欲しい。
    - コンピューターが返したbest moveに対して、x[ms]になるまでGUI側が指し手を無視する機能を用意しました。
    - 対局設定ダイアログの「コンピューターは1手に必ずこれだけ使う」
  - KIF/CSA: 激指定跡道場4への対応 #53(Mizarさんのプルリク)
    - 『激指定跡道場4』で書き出したCSA形式のファイルが読み込めなかったのを修正。
  - Updater、管理者権限で実行されていればUpdaterの再起動をしないコードを追加。


- "1.1.5"→"1.1.6" [2018/09/08]-[2018/09/10]
  - メニューの「表示」→「対局者名の先頭の手番記号」追加。「☗」「☖」か、「▲」「△」を付与できるようにした。
  - 対局結果、駒落ちのときの結果を先手勝ちではなく下手勝ちのようにする。(math26さん)
    - この対応のため、対局結果のcsvに平手か駒落ちかも出力するfieldを追加しました。
    - 以前の棋譜に対しては対局結果画面で見ても修正されません。以降の駒落ち戦のみ修正して記録されます。
  - .KIFなどの棋譜ファイルを拡張子関連付けで本ソフトと関連付けたときにうまく起動するようにした。
    - コマンドラインの第1パラメーターに棋譜ファイル名があるときはそれを開くべき棋譜ファイル名と解釈するようにした。
  - 起動時のworking directoryをMyShogi.exeが存在したフォルダに設定するコード追加。
    - ショートカットから起動するときにworking directoryが異なるとうまく画面素材などを読み込めないのでこのコードを追加した。
  - メインウインドウを最小化したときに検討ウインドウをタスクバー上で非表示に。(kumaさん)
    - 対応しました。最小化から復帰させたときに他のウインドウの背後に行くので、メインウインドウと親子関係を持たせる改造もしたほうがよさげ。
  - 対局終了直後だけ、「◀」ボタンを押しても一手戻らない件。
    - 修正しました。
  - 棋譜ウインドウの表示位置を変更したときに一瞬、変な位置に表示されてから移動していたのを修正。
  - 棋譜を開くときに、棋譜ウインドウがTopMostなのでファイルダイアログより前面に出てくるの改善。
    - Owner設定するようにして、TopMostやめた。


- "1.1.4"→"1.1.5" [2018/09/07]-[2018/09/07]
  - メインウインドウを最小化したときに棋譜ウインドウをウインドウ化しているときには非表示にするように。(kumaさん)
  - 実行ファイルのアプリケーションアイコンを設定。(kumaさん)
  - 棋譜ウインドウ、ウインドウモード時に、文字サイズを変更するボタンを追加。(右下の「+」と「-」)
  - 棋譜ウインドウに「消一手」ボタン追加。
    - 棋譜の末尾を1手消す操作
    - 棋譜ウインドウのボタンにtooltip追加。
  - V1.1.4で対局中に閉じるときなど、警告ダイアログが2回出るようになっていたの修正。
  - tanuki-詰将棋エンジン , 置換表エントリの世代を削除し、置換表エントリのハッシュの最下位ビットに探索開始局面の手番を入れるようにした #89 (tanuki-さん。やねうら王へのプルリク)
    - この修正により、一度解いた局面を解かせるときには一瞬で応答が返ってくるようになった。
  - tanuki-詰将棋エンジン バグ修正。
    詰将棋ルーチンで受け側の局面から探索させたあとに攻め側の局面から探索させると不詰と出力されるバグを修正した #88 (tanuki-さんのやねうら王へのプルリク)


- "1.1.3"→"1.1.4" [2018/09/04]-[2018/09/06]
  - CSA: 一部ツールの出力する棋譜による不具合に対応 #52 (Mizarさんのプルリク)
    - 将棋ウォーズ棋譜管理ツールというフリーソフトで保存したcsa形式のファイルが読み込めない。(てらっちさん)
  - メニューの「ウインドウ」→「棋譜ウインドウ」→「表示位置」でフロート機能などを使えるようになった。
    - フロート状態を次回起動時に復元するようにした。
    - Dock機能追加。メインウインドウに対して上下左右、好きなところにDockさせられるようにする。
  - tanuki-詰将棋エンジン、ハッシュエントリをつぶすとき、探索ノード数を考慮するようにした #87 tanuki-さんのやねうら王へのプルリク
  - 駒をクリックするときにマウスカーソルを微小動かすと駒のドラッグ処理になり、駒を掴んだ直後に駒を離してしまう。(地球市民さん)
    - 確かにあまり嬉しくない挙動なので修正しました。
  - 連続対局のときの勝数、win-lose-draw ではなくwin-draw-loseに変更する。(odagaki0621さん)


## 過去の改修履歴

- ここ以前の改修履歴については、[過去の改修履歴](過去の改修履歴.md)のほうに移動させました。
